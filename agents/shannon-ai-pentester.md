# Shannon AI Pentester Architecture

> **Source:** [keygraphHQ/shannon](https://github.com/keygraphHQ/shannon)
> **License:** GPL-3.0
> **Description:** Fully autonomous AI pentester that delivers actual exploits, not just alerts. Uses Temporal for crash-safe workflow orchestration.

## Overview

Shannon is an AI pentester that autonomously hunts for attack vectors in code, then executes real exploits using its built-in browser to prove vulnerabilities are actually exploitable.

## Five-Phase Testing Workflow

```
Pre-Reconnaissance → Reconnaissance → Vulnerability Analysis → Exploitation → Reporting
```

### 1. Pre-Reconnaissance (`pre-recon`)
External tool scans (nmap, subfinder, whatweb) + source code analysis

### 2. Reconnaissance (`recon`)
Analysis of initial findings and attack surface mapping

### 3. Vulnerability Analysis (5 agents in parallel)
- `injection-vuln` — SQL injection, command injection
- `xss-vuln` — Cross-site scripting
- `auth-vuln` — Authentication bypasses
- `authz-vuln` — Authorization flaws
- `ssrf-vuln` — Server-side request forgery

### 4. Exploitation (5 agents in parallel, only if vulnerabilities found)
- `injection-exploit` — Exploit injection vulnerabilities
- `xss-exploit` — Exploit XSS vulnerabilities
- `auth-exploit` — Exploit authentication issues
- `authz-exploit` — Exploit authorization flaws
- `ssrf-exploit` — Exploit SSRF vulnerabilities

### 5. Reporting (`report`)
Executive-level security report generation

## Temporal Orchestration

Uses Temporal for durable workflow orchestration:

- **Crash recovery** — Workflows resume automatically after worker restart
- **Queryable progress** — Real-time status via Temporal Web UI
- **Intelligent retry** — Distinguishes transient vs permanent errors
- **Parallel execution** — 5 concurrent agents in vulnerability/exploitation phases

## Core Architecture

### Agent Configuration

Claude Agent SDK with maximum autonomy:
```typescript
{
  maxTurns: 10_000,  // Extensive autonomous analysis
  permissionMode: 'bypassPermissions',  // Full system access
  // Playwright MCP integration for browser automation
  // Working directory set to target local repository
}
```

### Prompt Template System

Variable substitution for context injection:
- `{{TARGET_URL}}` — Target application URL
- `{{CONFIG_CONTEXT}}` — YAML configuration contents
- `{{LOGIN_INSTRUCTIONS}}` — Authentication flow template

### Configuration-Driven Testing

YAML configs with JSON Schema validation:
- Authentication settings (form, SSO, API, basic auth)
- Multi-factor authentication with TOTP support
- Custom login flow instructions
- Application-specific testing parameters

## Audit & Metrics System

Crash-safe logging with:
- Append-only logging with immediate flush
- Atomic writes for session.json
- Event-based logging (tool_start, tool_end, llm_response)
- Phase-level and agent-level timing/cost aggregations

### Output Structure

```
audit-logs/{hostname}_{sessionId}/
├── session.json      # Comprehensive metrics
├── prompts/          # Exact prompts for reproducibility
├── agents/           # Turn-by-turn execution logs
└── deliverables/     # Security reports and findings
```

## Key Design Principles

- **Exploit, don't just alert** — Real browser-based exploitation proves vulnerabilities
- **Parallel vulnerability scanning** — 5x faster with concurrent agents
- **Crash-safe by design** — Temporal ensures no work is lost
- **Evidence-based reporting** — Metrics and logs for every finding
- **Configuration-driven** — YAML configs for different target applications
